<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presidential Solitaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('bg.jpg');
            background-repeat: repeat-y;
            background-size: cover;
            background-position: center -300px;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        #game-area {
            max-width: 1400px; /* Increased from 1200px */
            display: none;
        }
        #status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
            color: #FFD700;
        }
        #top-row {
            display: flex;
            align-items: flex-start;
            flex-wrap: nowrap;
            justify-content: space-between;
            margin-top: 25px;
        }
        .pile {
            width: 135px;
            height: 600px;
            margin-right: 20px; /* Increased spacing */
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            box-sizing: border-box;
            border: 3px solid #ccc;
            border-radius: 10px;
        }
        .foundation {
            width: 135px;
            height: 600px;
            margin-right: 20px; /* Increased spacing */
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        .stock-waste-container {
            width: 210px; /* 150% of original 140px */
            display: flex;
            flex-direction: column;
            margin-right: 25px;
            margin-left: 25px;
        }
        #stock {
            height: 309.375px; /* 150% of original 206.25px */
            width: 210px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        #waste {
            height: 400px; /* Enlarged for larger cards */
            width: 210px;
            margin-top: 10px;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        .foundation-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 20px;
        }
        .cheat-sheet {
            position: absolute;
            left: 0;
            width: 100%;
            font-size: 12px;
            font-weight: bold;
            color: #FFD700;
            text-align: center;
            z-index: 10;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
            box-sizing: border-box;
        }
        .president-info {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 70px;
            z-index: 10;
            background: black;
            padding: 5px;
            box-sizing: border-box;
        }
        .president-entry {
            margin-bottom: 10px;
        }
        .president-entry p {
            margin: 0;
            line-height: 1;
        }
        .card-container {
            position: absolute;
            width: 100%;
            height: 186px;
            left: 0;
        }
        .card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
        }
        .card img {
            pointer-events: none;
            display: block;
            width: 100%;
            height: 100%;
            object-fit: contain;
            border: none;
            margin: 0;
            padding: 0;
        }
        .card.republican .card-hover {
            color: #FF6666;
        }
        .card.democratic .card-hover {
            color: #6666FF;
        }
        .card.other .card-hover {
            color: #d4a017;
        }
        .label {
            position: absolute;
            top: -20px;
            width: 100%;
            text-align: center;
            font-size: 14px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        .stock-image {
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .reload-button {
            padding: 10px 20px;
            font-size: 14px;
            background: #FFD700;
            border: none;
            cursor: pointer;
            text-align: center;
            margin: auto;
        }
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #splash-content {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 600px;
        }
        #splash-content h1 {
            margin-bottom: 20px;
        }
        #splash-content p {
            margin-bottom: 20px;
        }
        #start-button {
            padding: 10px 20px;
            font-size: 16px;
            background: #FFD700;
            border: none;
            cursor: pointer;
        }
        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
        @keyframes pulsate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .fade-out-r { animation: fadeOut 5s forwards; }
        .fade-out-d { animation: fadeOut 5s 5s forwards; }
        .fade-out-o { animation: fadeOut 5s 10s forwards; }
        .pulsate { animation: pulsate 1s 3; }
        .card-hover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            line-height: 30px;
            font-size: 14px;
            display: none;
            z-index: 100;
            pointer-events: none;
        }
        #high-score-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #high-score-content {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
        }
        #high-score-content h2 {
            margin-bottom: 20px;
        }
        #high-score-content ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }
        #high-score-content li {
            margin-bottom: 5px;
        }
        #close-high-scores {
            padding: 10px 20px;
            font-size: 16px;
            background: #FFD700;
            border: none;
            cursor: pointer;
        }
        .selected {
            border: 2px solid yellow;
            box-shadow: 0 0 10px yellow;
        }
        .drag-ghost {
            position: absolute;
            pointer-events: none;
            z-index: 1001;
            opacity: 0.7;
        }
        .destination-highlight {
            border: 2px dotted green;
        }
        #show-cards-button {
            font-size: 18px;
            font-weight: bold;
            border: 2px solid #FFD700;
            padding: 10px;
            margin: 10px;
            display: none;
        }
        .show-card-info .card-hover {
            display: block;
        }
        .waste-card {
            transform: scale(1.5); /* 150% scale */
            transform-origin: top left;
            margin-bottom: 60px; /* Adjusted spacing */
        }
    </style>
</head>
<body>
    <div id="splash-screen">
        <div id="splash-content">
            <h1>Welcome to Presidential Solitaire</h1>
            <p>Rules of the Game:<br>
            - Build the foundation piles in reverse chronological order for each suit.<br>
            - Use the tableau to arrange cards in alternating suits.<br>
            - "Other" presidents act as wildcards in the tableau.<br>
            - Draw cards from the stock to the waste pile in sets of three.<br>
            - Win by completing all foundation piles!</p>
            <button id="start-button">Start Game</button>
        </div>
    </div>

    <div id="game-area">
        <div id="status-bar">
            <span id="timer">Time: 0s</span>
            <span id="stock-counter">Reshuffles: 0</span>
        </div>
        <button id="show-cards-button">SHOW CARDS</button>
        <div id="top-row">
            <div id="tableau-0" class="pile"><div class="label">Tableau 1</div></div>
            <div id="tableau-1" class="pile"><div class="label">Tableau 2</div></div>
            <div id="tableau-2" class="pile"><div class="label">Tableau 3</div></div>
            <div class="stock-waste-container">
                <div id="stock"></div>
                <div id="waste"><div class="label">Waste</div></div>
            </div>
            <div class="foundation-group">
                <div id="foundation-r" class="foundation">
                    <div class="label">Republican</div>
                    <div class="president-info" id="info-r"></div>
                    <div class="cheat-sheet" id="cheat-r"></div>
                </div>
            </div>
            <div class="foundation-group">
                <div id="foundation-d" class="foundation">
                    <div class="label">Democratic</div>
                    <div class="president-info" id="info-d"></div>
                    <div class="cheat-sheet" id="cheat-d"></div>
                </div>
            </div>
            <div class="foundation-group">
                <div id="foundation-o" class="foundation">
                    <div class="label">Other</div>
                    <div class="president-info" id="info-o"></div>
                    <div class="cheat-sheet" id="cheat-o"></div>
                </div>
            </div>
        </div>
        <button id="new-game-button" style="display: none;">New Game</button>
    </div>

    <div id="high-score-screen">
        <div id="high-score-content">
            <h2>High Scores</h2>
            <ul id="high-score-list"></ul>
            <button id="close-high-scores">Close</button>
        </div>
    </div>

    <script>
        const presidents = [
            { name: "Washington", suit: "other", rank: 1, term: "1789-1797", number: "First President" },
            { name: "J. Adams", suit: "other", rank: 2, term: "1797-1801", number: "Second President" },
            { name: "Jefferson", suit: "democratic", rank: 3, term: "1801-1809", number: "Third President" },
            { name: "Madison", suit: "democratic", rank: 4, term: "1809-1817", number: "Fourth President" },
            { name: "Monroe", suit: "democratic", rank: 5, term: "1817-1825", number: "Fifth President" },
            { name: "J.Q. Adams", suit: "other", rank: 6, term: "1825-1829", number: "Sixth President" },
            { name: "Jackson", suit: "democratic", rank: 7, term: "1829-1837", number: "Seventh President" },
            { name: "Van Buren", suit: "democratic", rank: 8, term: "1837-1841", number: "Eighth President" },
            { name: "W.H. Harrison", suit: "other", rank: 9, term: "1841", number: "Ninth President" },
            { name: "Tyler", suit: "other", rank: 10, term: "1841-1845", number: "Tenth President" },
            { name: "Polk", suit: "democratic", rank: 11, term: "1845-1849", number: "Eleventh President" },
            { name: "Taylor", suit: "other", rank: 12, term: "1849-1850", number: "Twelfth President" },
            { name: "Fillmore", suit: "other", rank: 13, term: "1850-1853", number: "Thirteenth President" },
            { name: "Pierce", suit: "democratic", rank: 14, term: "1853-1857", number: "Fourteenth President" },
            { name: "Buchanan", suit: "democratic", rank: 15, term: "1857-1861", number: "Fifteenth President" },
            { name: "Lincoln", suit: "republican", rank: 16, term: "1861-1865", number: "Sixteenth President" },
            { name: "Johnson", suit: "democratic", rank: 17, term: "1865-1869", number: "Seventeenth President" },
            { name: "Grant", suit: "republican", rank: 18, term: "1869-1877", number: "Eighteenth President" },
            { name: "Hayes", suit: "republican", rank: 19, term: "1877-1881", number: "Nineteenth President" }
            // Add remaining presidents as needed
        ];

        let stock = [...presidents];
        let waste = [];
        let tableau = [[], [], []];
        let foundations = { republican: [], democratic: [], other: [] };
        let draggedElement = null;
        let dragGhost = null;
        let timerInterval;
        let timeElapsed = 0;
        let reshuffles = 0;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function createCard(president, scale = 1) {
            const container = document.createElement('div');
            container.className = 'card-container';
            const card = document.createElement('div');
            card.className = `card ${president.suit}`;
            card.draggable = true;
            card.dataset.rank = president.rank;
            card.dataset.suit = president.suit;
            const img = document.createElement('img');
            img.src = `cards/${president.name}.png`; // Placeholder image path
            card.appendChild(img);
            const hover = document.createElement('div');
            hover.className = 'card-hover';
            hover.textContent = `${president.name} (${president.term})`;
            card.appendChild(hover);
            container.appendChild(card);
            if (scale !== 1) {
                container.classList.add('waste-card');
            }
            return container;
        }

        function dealCards() {
            shuffle(stock);
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 5 && stock.length > 0; j++) {
                    tableau[i].push(stock.pop());
                }
            }
            renderGame();
        }

        function renderGame() {
            // Stock
            const stockDiv = document.getElementById('stock');
            stockDiv.innerHTML = stock.length > 0 
                ? '<img src="card-back.png" class="stock-image">' 
                : '<button class="reload-button" onclick="reloadStock()">Reload</button>';

            // Waste
            const wasteDiv = document.getElementById('waste');
            wasteDiv.innerHTML = '<div class="label">Waste</div>';
            waste.forEach((president, index) => {
                const card = createCard(president, 1.5);
                card.style.top = `${index * 60}px`; // Adjusted for larger cards
                wasteDiv.appendChild(card);
            });

            // Tableau
            for (let i = 0; i < 3; i++) {
                const pile = document.getElementById(`tableau-${i}`);
                pile.innerHTML = '<div class="label">Tableau ' + (i + 1) + '</div>';
                tableau[i].forEach((president, index) => {
                    const card = createCard(president);
                    card.style.top = `${index * 30}px`;
                    pile.appendChild(card);
                });
            }

            // Foundations
            ['republican', 'democratic', 'other'].forEach(suit => {
                const foundation = document.getElementById(`foundation-${suit.charAt(0)}`);
                foundation.innerHTML = `<div class="label">${suit.charAt(0).toUpperCase() + suit.slice(1)}</div>
                    <div class="president-info" id="info-${suit.charAt(0)}"></div>
                    <div class="cheat-sheet" id="cheat-${suit.charAt(0)}"></div>`;
                foundations[suit].forEach((president, index) => {
                    const card = createCard(president);
                    card.style.top = `${index * 30}px`;
                    foundation.appendChild(card);
                });
                updatePresidentInfo(suit);
            });

            updateStockCounter();
        }

        function updatePresidentInfo(suit) {
            const infoDiv = document.getElementById(`info-${suit.charAt(0)}`);
            const topCard = foundations[suit].slice(-1)[0];
            infoDiv.innerHTML = topCard 
                ? `<p>${topCard.name}</p><p>${topCard.term}</p><p>${topCard.number}</p>` 
                : '';
        }

        function drawCards() {
            if (stock.length === 0) return;
            const drawCount = Math.min(3, stock.length);
            for (let i = 0; i < drawCount; i++) {
                waste.push(stock.pop());
            }
            renderGame();
        }

        function reloadStock() {
            if (stock.length === 0 && waste.length > 0) {
                stock = waste.reverse();
                waste = [];
                reshuffles++;
                renderGame();
            }
        }

        function updateStockCounter() {
            document.getElementById('stock-counter').textContent = `Reshuffles: ${reshuffles}`;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeElapsed++;
                document.getElementById('timer').textContent = `Time: ${timeElapsed}s`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function checkWin() {
            return foundations.republican.length + foundations.democratic.length + foundations.other.length === presidents.length;
        }

        // Drag and Drop
        document.addEventListener('dragstart', (e) => {
            const card = e.target.closest('.card');
            if (!card) return;
            draggedElement = card.parentElement;
            e.dataTransfer.setData('text/plain', JSON.stringify({
                rank: card.dataset.rank,
                suit: card.dataset.suit,
                source: draggedElement.parentElement.id
            }));

            // Create drag ghost
            dragGhost = draggedElement.cloneNode(true);
            dragGhost.classList.add('drag-ghost');
            if (draggedElement.classList.contains('waste-card')) {
                dragGhost.style.transform = 'scale(1.5)';
            }
            document.body.appendChild(dragGhost);
            const rect = draggedElement.getBoundingClientRect();
            dragGhost.style.left = `${rect.left}px`;
            dragGhost.style.top = `${rect.top}px`;
        });

        document.addEventListener('dragend', () => {
            if (dragGhost) {
                document.body.removeChild(dragGhost);
                dragGhost = null;
            }
            draggedElement = null;
            document.querySelectorAll('.destination-highlight').forEach(el => el.classList.remove('destination-highlight'));
        });

        document.addEventListener('dragover', (e) => {
            e.preventDefault();
            if (dragGhost) {
                dragGhost.style.left = `${e.pageX - 50}px`;
                dragGhost.style.top = `${e.pageY - 50}px`;
            }
        });

        document.addEventListener('drop', (e) => {
            e.preventDefault();
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const target = e.target.closest('.pile, .foundation');
            if (!target || !draggedElement) return;

            const sourcePile = document.getElementById(data.source);
            const cardIndex = Array.from(sourcePile.children).indexOf(draggedElement) - 1; // Adjust for label

            if (target.classList.contains('pile')) {
                const pileIndex = parseInt(target.id.split('-')[1]);
                const pileCards = tableau[pileIndex];
                const card = waste.find(p => p.rank == data.rank && p.suit === data.suit) || 
                             tableau.flat().find(p => p.rank == data.rank && p.suit === data.suit);
                if (card && (pileCards.length === 0 || canPlaceOnTableau(card, pileCards[pileCards.length - 1]))) {
                    if (data.source === 'waste') {
                        waste.splice(waste.indexOf(card), 1);
                    } else {
                        tableau.forEach(p => {
                            const idx = p.indexOf(card);
                            if (idx !== -1) p.splice(idx, 1);
                        });
                    }
                    pileCards.push(card);
                }
            } else if (target.classList.contains('foundation')) {
                const suit = target.id.split('-')[1] === 'r' ? 'republican' : target.id.split('-')[1] === 'd' ? 'democratic' : 'other';
                const foundationCards = foundations[suit];
                const card = waste.find(p => p.rank == data.rank && p.suit === data.suit) || 
                             tableau.flat().find(p => p.rank == data.rank && p.suit === data.suit);
                if (card && card.suit === suit && (foundationCards.length === 0 || card.rank === foundationCards[foundationCards.length - 1].rank + 1)) {
                    if (data.source === 'waste') {
                        waste.splice(waste.indexOf(card), 1);
                    } else {
                        tableau.forEach(p => {
                            const idx = p.indexOf(card);
                            if (idx !== -1) p.splice(idx, 1);
                        });
                    }
                    foundationCards.push(card);
                }
            }

            renderGame();
            if (checkWin()) {
                stopTimer();
                alert(`You won in ${timeElapsed} seconds with ${reshuffles} reshuffles!`);
            }
        });

        function canPlaceOnTableau(card, topCard) {
            if (!topCard) return true;
            if (card.suit === 'other' || topCard.suit === 'other') return true;
            return card.suit !== topCard.suit;
        }

        // Touch Support
        let touchStartTime;
        let touchCount = 0;

        document.addEventListener('touchstart', (e) => {
            const card = e.target.closest('.card');
            if (!card) return;
            touchStartTime = Date.now();
            touchCount = e.touches.length;
            draggedElement = card.parentElement;

            dragGhost = draggedElement.cloneNode(true);
            dragGhost.classList.add('drag-ghost');
            if (draggedElement.classList.contains('waste-card')) {
                dragGhost.style.transform = 'scale(1.5)';
            }
            document.body.appendChild(dragGhost);
            const rect = draggedElement.getBoundingClientRect();
            dragGhost.style.left = `${rect.left}px`;
            dragGhost.style.top = `${rect.top}px`;
        });

        document.addEventListener('touchmove', (e) => {
            if (dragGhost) {
                e.preventDefault();
                const touch = e.touches[0];
                dragGhost.style.left = `${touch.pageX - 50}px`;
                dragGhost.style.top = `${touch.pageY - 50}px`;
            }
        });

        document.addEventListener('touchend', (e) => {
            if (!draggedElement) return;
            const duration = Date.now() - touchStartTime;
            if (touchCount === 2 && duration < 300) {
                draggedElement.classList.toggle('selected');
            } else if (touchCount === 1 && duration < 300) {
                // Double-tap simulation
                const target = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
                const pile = target.closest('.pile, .foundation');
                if (pile) {
                    const data = {
                        rank: draggedElement.querySelector('.card').dataset.rank,
                        suit: draggedElement.querySelector('.card').dataset.suit,
                        source: draggedElement.parentElement.id
                    };
                    const event = new CustomEvent('drop', { detail: data });
                    pile.dispatchEvent(event);
                }
            }

            if (dragGhost) {
                document.body.removeChild(dragGhost);
                dragGhost = null;
            }
            draggedElement = null;
        });

        // Event Listeners
        document.getElementById('start-button').addEventListener('click', () => {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            document.getElementById('show-cards-button').style.display = 'block';
            dealCards();
            startTimer();
        });

        document.getElementById('stock').addEventListener('click', drawCards);

        document.getElementById('show-cards-button').addEventListener('click', () => {
            document.body.classList.toggle('show-card-info');
        });
    </script>
</body>
</html>